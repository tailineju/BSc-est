---
title: "Centro Colaborador de Apoio ao Monitoramento e à Gestão de Programas Educacionais do Centro Oeste"
subtitle: "Monitoramento e Apoio às UEx do PDDE Básico e  PDDE Ações Integradas"
author: "Tailine J. S. Nonato"
format: pdf
---

# Entrega 4: Análise de Saldos e Repasses

## Repasses
```{r}
#| message: false
#| warning: false
#| echo: false
if (!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, knitr, kableExtra)
setwd("C:/Users/User/Documents/GitHub/gradest-1/PDDE/entrega 4")
```


```{r}
#| message: false
#| warning: false
#| echo: false

# Lendo o dataset
dados <- read_csv("pdde_pagos.csv", skip=5) 

# Limpeza
dados2 <- dados %>%
  mutate(`Valor Custeio` = as.numeric(str_replace_all(`Valor Custeio`, "\\.", "")),
         `Valor Capital` = as.numeric(str_replace_all(`Valor Capital`, "\\.", "")),
         `Valor Total` = as.numeric(`Valor Custeio` + `Valor Capital`))

# Verificar repasse por destinação
#kable(unique(dados2$`Destinação`))

# Somando o repasse de cada escola e criando um df onde cada linha é uma escola
dados3 <- dados2 %>%
  group_by(`Código Escola`) %>%
  summarise(`Valor Total` = sum(`Valor Total`), `Valor Custeio` = sum(`Valor Custeio`), `Valor Capital` = sum(`Valor Capital`))
head(dados3)
```

### Tabela 1: Soma, Média e Desvio Padrão

```{r}
#| message: false
#| warning: false
#| echo: false

# Calculando a soma, média e desvio padrão
soma <- sum(dados3$`Valor Total`)
media <- mean(dados3$`Valor Total`)
desvio <- sd(dados3$`Valor Total`)

soma_custeio <- sum(dados3$`Valor Custeio`)
media_custeio <- mean(dados3$`Valor Custeio`)
desvio_custeio <- sd(dados3$`Valor Custeio`)

soma_capital <- sum(dados3$`Valor Capital`)
media_capital <- mean(dados3$`Valor Capital`)
desvio_capital <- sd(dados3$`Valor Capital`)

soma_custeio_perc <- sum(dados3$`Valor Custeio`)/sum(dados3$`Valor Total`)
soma_capital_perc <- sum(dados3$`Valor Capital`)/sum(dados3$`Valor Total`)
media_custeio_perc <- mean(dados3$`Valor Custeio`)/mean(dados3$`Valor Total`)

media_capital_perc <- mean(dados3$`Valor Capital`)/mean(dados3$`Valor Total`)
desvio_custeio_perc <- sd(dados3$`Valor Custeio`)/sd(dados3$`Valor Total`)
desvio_capital_perc <- sd(dados3$`Valor Capital`)/sd(dados3$`Valor Total`)

# Custeio percentual to %
soma_custeio_perc <- paste0(round(soma_custeio_perc*100, 2), "%")
media_custeio_perc <- paste0(round(media_custeio_perc*100, 2), "%")
desvio_custeio_perc <- paste0(round(desvio_custeio_perc*100, 2), "%")

# Capital percentual to %
soma_capital_perc <- paste0(round(soma_capital_perc*100, 2), "%")
media_capital_perc <- paste0(round(media_capital_perc*100, 2), "%")
desvio_capital_perc <- paste0(round(desvio_capital_perc*100, 2), "%")

# Valor Total to R$
soma <- paste0("R$", format(soma, big.mark = ".", decimal.mark = ","))
media <- paste0("R$", format(media, big.mark = ".", decimal.mark = ","))
desvio <- paste0("R$", format(desvio, big.mark = ".", decimal.mark = ","))

# Valor Custeio to R$
soma_custeio <- paste0("R$", format(soma_custeio, big.mark = ".", decimal.mark = ","))
media_custeio <- paste0("R$", format(media_custeio, big.mark = ".", decimal.mark = ","))
desvio_custeio <- paste0("R$", format(desvio_custeio, big.mark = ".", decimal.mark = ","))

# Valor Capital to R$
soma_capital <- paste0("R$", format(soma_capital, big.mark = ".", decimal.mark = ","))
media_capital <- paste0("R$", format(media_capital, big.mark = ".", decimal.mark = ","))
desvio_capital <- paste0("R$", format(desvio_capital, big.mark = ".", decimal.mark = ","))

# Criando a tabela
estatisticas <- data.frame("Soma" = c(soma, soma_custeio, soma_custeio_perc, soma_capital, soma_capital_perc),
                           "Média" = c(media, media_custeio, media_custeio_perc, media_capital, media_capital_perc),
                           "Desvio Padrão" = c(desvio, desvio_custeio, desvio_custeio_perc, desvio_capital, desvio_capital_perc))

rownames(estatisticas) <- c("Valor Total", "Valor Custeio", "Valor Custeio (%)", "Valor Capital", "Valor Capital (%)")

# Transpor a tabela
estatisticas <- t(estatisticas)

estatisticas
```	

### Tabela 2: Percentis, Mínimo e Máximo

```{r}
#| message: false
#| warning: false
#| echo: false

# Calculando o mínimo
minimo_total <- min(dados3$`Valor Total`)
minimo_custeio <- min(dados3$`Valor Custeio`)
minimo_capital <- min(dados3$`Valor Capital`)

# Formatando para R$
minimo_total <- paste0("R$", format(minimo_total, big.mark = ".", decimal.mark = ","))
minimo_custeio <- paste0("R$", format(minimo_custeio, big.mark = ".", decimal.mark = ","))
minimo_capital <- paste0("R$", format(minimo_capital, big.mark = ".", decimal.mark = ","))

# Calculando os percentis
percentis_total <- quantile(dados3$`Valor Total`, c(0.1, 0.25, 0.5, 0.75, 0.9))
percentis_custeio <- quantile(dados3$`Valor Custeio`, c(0.1, 0.25, 0.5, 0.75, 0.9))
percentis_capital <- quantile(dados3$`Valor Capital`, c(0.1, 0.25, 0.5, 0.75, 0.9))

# Formatando para R$
percentis_total <- paste0("R$", format(percentis_total, big.mark = ".", decimal.mark = ","))
percentis_custeio <- paste0("R$", format(percentis_custeio, big.mark = ".", decimal.mark = ","))
percentis_capital <- paste0("R$", format(percentis_capital, big.mark = ".", decimal.mark = ","))

# Calculando o máximo
maximo_total <- max(dados3$`Valor Total`)
maximo_custeio <- max(dados3$`Valor Custeio`)
maximo_capital <- max(dados3$`Valor Capital`)

# Formatando para R$
maximo_total <- paste0("R$", format(maximo_total, big.mark = ".", decimal.mark = ","))
maximo_custeio <- paste0("R$", format(maximo_custeio, big.mark = ".", decimal.mark = ","))
maximo_capital <- paste0("R$", format(maximo_capital, big.mark = ".", decimal.mark = ","))

# Criando a tabela
percentis <- data.frame("min" = c(minimo_total, minimo_custeio, minimo_capital),
                        "p10" = c(percentis_total[1], percentis_custeio[1], percentis_capital[1]),
                        "p25" = c(percentis_total[2], percentis_custeio[2], percentis_capital[2]),
                        "p50" = c(percentis_total[3], percentis_custeio[3], percentis_capital[3]),
                        "p75" = c(percentis_total[4], percentis_custeio[4], percentis_capital[4]),
                        "p90" = c(percentis_total[5], percentis_custeio[5], percentis_capital[5]),
                        "max" = c(maximo_total, maximo_custeio, maximo_capital))

rownames(percentis) <- c("Valor Total", "Valor Custeio", "Valor Capital")
colnames(percentis) <- c("Mínimo", "Percentil 10", "1º Quartil", "Mediana", "3º Quartil", "Percentil 90", "Máximo")

# Transpor a tabela
percentis <- t(percentis)
percentis

```

### Tabela 3: Frequencia de escolas por faixa de valor total recebido

```{r}
#| message: false
#| warning: false
#| echo: false

# Criando a tabela
dados3$faixa <- cut(dados3$`Valor Total`, breaks = c(0, 500, 1000, 5000, 10000, 20000, 35000, 50000, 80000, Inf), labels = c("Até R$500", "R$501 a R$1000", "R$1001 a R$5000", "R$5001 a R$10000", "R$10001 a R$20000", "R$20001 a R$35000", "R$35001 a R$50000", "R$50001 a R$80000","Mais de R$80000"))

# Tabela de frequencia
tabela_freq <- table(dados3$faixa)
tabela_freq <- data.frame("Faixa" = names(tabela_freq), "Frequência" = as.numeric(tabela_freq))

# Ordenando a tabela
tabela_freq <- tabela_freq %>%
  mutate(Faixa = factor(Faixa, levels = c("Até R$500", "R$501 a R$1000", "R$1001 a R$5000", "R$5001 a R$10000", "R$10001 a R$20000", "R$20001 a R$35000", "R$35001 a R$50000", "R$50001 a R$80000","Mais de R$80000")))

# Adicionando a coluna de percentual
tabela_freq <- tabela_freq %>%
  mutate(Percentual = round(Frequência/sum(Frequência)*100, 2))

# Adicionando a linha de totais
tabela_freq <- rbind(tabela_freq, c("Total", sum(tabela_freq$Frequência), sum(tabela_freq$Percentual)))

tabela_freq

```
