---
title: "Cecampe-CO/PDDE"
subtitle: "Entrega 1"
author: "Tailine J. S. Nonato"
format: pdf
---

```{r}
#| message: false
#| warning: false
#| echo: false
if (!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, knitr, openxlsx)
setwd("C:/Users/User/Documents/GitHub/gradest/PDDE/entrega 1")
```

# Objetivo

Organizar os dados para identificar as escolas que não participaram do PDDE 2023. Depois de algum tratamento estas escolas serão objeto de monitoramento (Por que não estão no programa? Como o CECAMPE CO – MONITORAMENTO pode ajudá-las a ingressar no programa?)

# Resultados

## Mainupalação dos dados
```{r}	
#| warning: false
#| message: false
#| echo: false
censo22_co <- read.csv("dados/censo22_co.csv")
pdde_pagos <- read.csv("dados/pdde_pagos.csv", skip = 5)
pdde_naopagos <- read.csv("dados/pdde_naopagos.csv", skip = 5)

# Cruzamento dos dados (juntar as bases do censo e do pdde utlizando o código da escola como chave)
censo22_co$CO_ENTIDADE <- as.character(censo22_co$CO_ENTIDADE)
pdde_pagos$Código.Escola <- as.character(pdde_pagos$Código.Escola)
pdde_naopagos$Código.Escola <- as.character(pdde_naopagos$Código.Escola)

dados <- censo22_co %>% 
  left_join(pdde_pagos, by = c("CO_ENTIDADE" = "Código.Escola")) %>% 
  left_join(pdde_naopagos, by = c("CO_ENTIDADE" = "Código.Escola")) %>% 
  {if (all(c("NO_ENTIDADE", "CO_ENTIDADE", "NO_MUNICIPIO", "NO_UF", "TP_DEPENDENCIA", "TP_SITUACAO_FUNCIONAMENTO", "TP_LOCALIZACAO_DIFERENCIADA", "Situação.x", "Situação.y") %in% colnames(.))) 
    select(., NO_ENTIDADE, CO_ENTIDADE, NO_MUNICIPIO, NO_UF, TP_DEPENDENCIA, TP_SITUACAO_FUNCIONAMENTO, TP_LOCALIZACAO_DIFERENCIADA, Situação.x, Situação.y) else .} %>% 
  rename_at(vars(matches("Situação")), 
            ~c("PDDE_Pago", "PDDE_Não_Pago")[match(., c("Situação.x", "Situação.y"))]) %>% 
  mutate_at(vars(matches("Situação")), ~ifelse(is.na(.), "Não participa", .))

```

1. Número de escolas públicas segundo a dependência administrativa e a UF – Centro-Oeste
- Colunas: TP_DEPENDENCIA
- Linhas: NO_UF

```{r}	
#| warning: false
#| message: false
#| echo: false
tab1 <- censo22_co %>% 
        group_by(NO_UF, TP_DEPENDENCIA) %>% 
        summarise(n = n()) %>% 
        spread(TP_DEPENDENCIA, n, fill = 0) %>% 
        select(NO_UF, `1`, `2`, `3`, `4`) %>% 
        rename(`Federal` = `1`, `Estadual` = `2`, `Municipal` = `3`, `Privada` = `4`)
kable(tab1)
```	

2. Número de escolas públicas segundo a situação de funcionamento e a UF – Centro-Oeste
- Coluna: TP_SITUACAO_FUNCIONAMENTO
- Linhas: NO_UF

```{r}
#| warning: false
#| message: false
#| echo: false
tab2 <- censo22_co %>% 
  group_by(NO_UF, TP_SITUACAO_FUNCIONAMENTO) %>% 
  summarise(n = n()) %>% 
  spread(TP_SITUACAO_FUNCIONAMENTO, n, fill = 0) %>% 
  {if (all(c("1", "2", "3", "4", "5") %in% colnames(.))) select(., NO_UF, `1`, `2`, `3`, `4`, `5`) else .} %>% 
  rename_at(vars(matches("^[12345]$")), 
            ~c("Em atividade", "Paralisada", "Extinta", "Em atividade de educação especial", "Paralisada de educação especial")[match(., c("1", "2", "3", "4", "5"))])

kable(tab2)
```

3. Número de escolas públicas segundo a localização e a UF – Centro-Oeste (identificação das escolas em localização diferenciada)
- Coluna: TP_LOCALIZACAO_DIFERENCIADA
- Linhas: NO_UF

```{r}
#| warning: false
#| message: false
#| echo: false
tab3 <- censo22_co %>% 
  group_by(NO_UF, TP_LOCALIZACAO_DIFERENCIADA) %>% 
  summarise(n = n()) %>% 
  spread(TP_LOCALIZACAO_DIFERENCIADA, n, fill = 0) %>% 
  {if (all(c("0","1", "2", "3", "4") %in% colnames(.))) select(., NO_UF, `0`,`1`, `2`, `3`, `4`) else .} %>% 
  rename_at(vars(matches("^[01234]$")), 
            ~c("Não diferenciada", "Urbana", "Rural", "Rural de difícil acesso", "Indígena")[match(., c("0","1", "2", "3", "4"))])

kable(tab3)
```

## PDDE 2023 (Consulta Escola/FNDE)

Descrição da manipulação:
- Importação dos dados no Consulta Escola
- Conversão de xls para csv utilizando CloudConverter
- Importação dos dados no R

1. Número de escolas participantes do PDDE: Escolas PAGAS em 2023
- Coluna: Situação


## Exportando as tabelas para um arquivo Excel

```{r}
#| warning: false
#| message: false
#| echo: false

wb <- createWorkbook()
addWorksheet(wb, "tab1")
writeData(wb, "tab1", tab1)
addWorksheet(wb, "tab2")
writeData(wb, "tab2", tab2)
addWorksheet(wb, "tab3")
writeData(wb, "tab3", tab3)
saveWorkbook(wb, "dados/relatorio.xlsx", overwrite = TRUE)
```