---
title: "Análise Multinível SAEB 2019"
author: "Tailine J. S. Nonato"
date: "2024-06-29" 
format: html
---

# Sumário

1. Modelo Nulo

2. Adição de variáveis do primeiro nível (aluno)

3. Adição de variáveis do segundo nível (escola)

4. Adição de efeitos aleatórios do primeiro nível

5. Comparação entre modelos utilizando X²

6. Análise de resíduos

7. Definição do melhor modelo

# Setup

```{r}
#| warning: false

if (!require(pacman)) install.packages("pacman")
pacman::p_load(vroom,tidyverse,lme4,sjPlot,knitr) 
setwd("C:/Users/User/Documents/GitHub/gradest-1/TCC/relatorio")
```

## Leitura dos dados
```{r}	
#| warning: false
#| eval: false
#| echo: false

df <- vroom("dados_tcc.csv")%>%
  select(ID_ALUNO,ID_ESCOLA,PROFICIENCIA_MT_SAEB,PROFICIENCIA_LP_SAEB, NIVEL_SOCIO_ECONOMICO, NSEA, pont, ID_AREA, ID_LOCALIZACAO, TX_RESP_Q002, TX_RESP_Q004, TX_RESP_Q015, pont, escolaridade, NSE_pont)

df_used <- df %>%
  filter(across(everything(), ~ !(. %in% c("*", ".")))) %>%
  na.omit(df_used)
```	

```{r}	
#| warning: false
df_used <- vroom("df_used.csv")
```

# Modelos

## Língua Portuguesa

### Modelo 0
```{r}
#| warning: false
modelo_nulo_lp <- lmer(PROFICIENCIA_LP_SAEB ~ 1 + (1|ID_ESCOLA), data = df_used)
tab_model(modelo_nulo_lp, show.icc = TRUE, title="Modelo Nulo")
```	

### Modelo 1
```{r}
#| warning: false
modelo1_lp <- lmer(PROFICIENCIA_LP_SAEB ~ pont + TX_RESP_Q002 + escolaridade + TX_RESP_Q015 + (1|ID_ESCOLA), data = df_used)
tab_model(modelo1_lp, show.icc = TRUE, title="Modelo com adição de variáveis do primeiro nível")
```

### Modelo 2
```{r}
#| warning: false
modelo2_lp <- lmer(PROFICIENCIA_LP_SAEB ~ pont + TX_RESP_Q002 + escolaridade + TX_RESP_Q015 + NSE_pont + ID_AREA +  ID_LOCALIZACAO + (1|ID_ESCOLA), data = df_used)
tab_model(modelo2_lp, show.icc = TRUE, title="Modelo com adição de variáveis do segundo nível")
```

### Modelo 3
```{r}
#| warning: false
modelo3_lp <- lmer(PROFICIENCIA_LP_SAEB ~ pont + TX_RESP_Q002 + escolaridade + TX_RESP_Q015 + NSE_pont + ID_AREA +  ID_LOCALIZACAO + (TX_RESP_Q015|ID_ESCOLA), data = df_used)
tab_model(modelo3_lp, show.icc = TRUE, title="Modelo com adição de efeitos aleatórios do primeiro nível")
```

### Comparação entre modelos
```{r}
#| warning: false
kable(anova(modelo_nulo_lp, modelo1_lp))
kable(anova(modelo1_lp, modelo2_lp))
kable(anova(modelo2_lp, modelo3_lp))
```

### Análise de resíduos (Modelos com efeitos aleatórios)
```{r}
#| warning: false
residuos_lp <- resid(modelo3_lp)
qqnorm(residuos_lp)
qqline(residuos_lp)
```

## Matemática

### Modelo 0
```{r}
#| warning: false
modelo_nulo_mt <- lmer(PROFICIENCIA_MT_SAEB ~ 1 + (1|ID_ESCOLA), data = df_used)
tab_model(modelo_nulo_mt, show.icc = TRUE)
```	

### Modelo 1
```{r}
#| warning: false
modelo1_mt <- lmer(PROFICIENCIA_MT_SAEB ~ pont + TX_RESP_Q002 + escolaridade + TX_RESP_Q015 + (1|ID_ESCOLA), data = df_used)
tab_model(modelo1_mt, show.icc = TRUE, title="Modelo com adição de variáveis do primeiro nível")
```

### Modelo 2
```{r}
#| warning: false
modelo2_mt <- lmer(PROFICIENCIA_MT_SAEB ~ pont + TX_RESP_Q002 + escolaridade + TX_RESP_Q015 + NSE_pont + ID_AREA +  ID_LOCALIZACAO + (1|ID_ESCOLA), data = df_used)
tab_model(modelo2_mt, show.icc = TRUE, title="Modelo com adição de variáveis do segundo nível")
```	

### Modelo 3
```{r}
#| warning: false
modelo3_mt <- lmer(PROFICIENCIA_MT_SAEB ~ pont + TX_RESP_Q002 + escolaridade + TX_RESP_Q015 + NSE_pont + ID_AREA +  ID_LOCALIZACAO + (TX_RESP_Q015|ID_ESCOLA), data = df_used)
tab_model(modelo3_mt, show.icc = TRUE, title="Modelo com adição de efeitos aleatórios do primeiro nível")
```	

### Comparação entre modelos

```{r}
#| warning: false
kable(anova(modelo_nulo_lp, modelo1_lp))
kable(anova(modelo1_lp, modelo2_lp))
kable(anova(modelo2_mt, modelo3_mt))
```

## Análise de resíduos (Modelos com efeitos aleatórios)


```{r}
#| warning: false
residuos_mt <- resid(modelo3_mt)
qqnorm(residuos_mt)
qqline(residuos_mt)
```