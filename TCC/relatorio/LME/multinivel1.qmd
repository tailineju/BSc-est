---
title: "Análise Multinível SAEB 2019"
author: "Tailine J. S. Nonato"
date: today
format: html
---

# Sumário

1. Modelo Nulo

2. Adição de variáveis do primeiro nível (aluno)

3. Adição de variáveis do segundo nível (escola)

4. Adição de efeitos aleatórios do primeiro nível

5. Comparação entre modelos utilizando X²

6. Análise de resíduos

7. Definição do melhor modelo

# Mudanças

- [ ] Aprimoramento da PCA (inclusão de quase todas variáveis do bloco)

- [ ] Adição do grupo racial

- [ ] Alterações nos efeitos aleatórios

- [ ] Adição de interações



# Setup

```{r}
#| warning: false
#| label: pacotes

if (!require(pacman)) install.packages("pacman")
pacman::p_load(vroom,tidyverse,lme4,sjPlot,knitr) 
setwd("C:/Users/User/Documents/GitHub/gradest-1/TCC/relatorio")
```

## Leitura dos dados

```{r}	
#| warning: false
#| label: dados2

df_used <- vroom("DADOS/df_used.csv")
df_center <- vroom("DADOS/df_center.csv")
```

# Modelos

```{r}
#| eval: false
#| echo: false
#| warning: false 
#| label: modelo0_lp

### Modelo 0
## Língua Portuguesa
modelo_nulo_lp <- lmer(PROFICIENCIA_LP_SAEB ~ 1 + (1|ID_ESCOLA), data = df_used)
#summary(modelo_nulo_lp)
tab_model(modelo_nulo_lp, show.icc = TRUE, title="Modelo Nulo")
```	


```{r}
#| eval: false
#| echo: false
#| warning: false
#| label: modelo1_lp

### Modelo 1
modelo1_lp <- lmer(PROFICIENCIA_LP_SAEB ~ GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + (1|ID_ESCOLA), data = df_used)
#summary(modelo1_lp)
tab_model(modelo1_lp, show.icc = TRUE, title="Modelo com adição de variáveis do primeiro nível")
```

```{r}
#| warning: false
#| eval: false
#| echo: false
#| label: modelo2_lp


### Modelo 2
modelo2_lp <- lmer(PROFICIENCIA_LP_SAEB ~ GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA + ID_AREA +  ID_LOCALIZACAO + (1|ID_ESCOLA), data = df_used)
#summary(modelo2_lp)
tab_model(modelo2_lp, show.icc = TRUE, title="Modelo com adição de variáveis do segundo nível")
```


```{r}
#| warning: false
#| eval: false
#| echo: false
#| label: modelo3_lp1

### Modelo 3
modelo3_lp <- lmer(PROFICIENCIA_LP_SAEB ~ GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA + ID_AREA +  ID_LOCALIZACAO + (1 + REPROVACAO|ID_ESCOLA), data = df_used)
##summary(modelo3_lp)
tab_model(modelo3_lp, show.icc = TRUE, title="Modelo com adição de efeitos aleatórios do primeiro nível")
```

```{r}
#| warning: false
#| eval: false
#| echo: false
#| label: modelo3_lp2
modelo3_lp <- lmer(PROFICIENCIA_LP_SAEB ~ GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA + ID_AREA +  ID_LOCALIZACAO + (1 + GRUPO_RACIAL|ID_ESCOLA), data = df_used)
##summary(modelo3_lp)
tab_model(modelo3_lp, show.icc = TRUE, title="Modelo com adição de efeitos aleatórios do primeiro nível")
```

```{r}
#| warning: false
#| eval: false
#| echo: false
#| label: modelo3_lp3
modelo3_lp <- lmer(PROFICIENCIA_LP_SAEB ~ GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA  + ID_AREA +  ID_LOCALIZACAO + (1 + NSE_ALUNO|ID_ESCOLA), data = df_used)
##summary(modelo3_lp)
tab_model(modelo3_lp, show.icc = TRUE, title="Modelo com adição de efeitos aleatórios do primeiro nível")
```

```{r}
#| warning: false
#| eval: false
#| echo: false
#| label: modelo3_lp4
modelo3_lp <- lmer(PROFICIENCIA_LP_SAEB ~ GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA  + ID_AREA +  ID_LOCALIZACAO + (1 + NSE_ALUNO + GRUPO_RACIAL + REPROVACAO|ID_ESCOLA), data = df_used)
#summary(modelo3_lp)
tab_model(modelo3_lp, show.icc = TRUE, title="Modelo com adição de efeitos aleatórios do primeiro nível")
```


```{r}
#| warning: false
#| eval: false
#| echo: false
#| label: comparacaolp


summary(df_used$NSE_ALUNO)
sd(df_used$NSE_ALUNO)


### Comparação entre modelos
kable(anova(modelo_nulo_lp, modelo1_lp))
kable(anova(modelo1_lp, modelo2_lp))
#kable(anova(modelo2_lp, modelo3_lp))
```


```{r}
#| warning: false
#| eval: false
#| echo: false
#| label: residuos_lp

### Análise de resíduos (Modelos com efeitos aleatórios)
residuos_lp <- resid(modelo3_lp)
qqnorm(residuos_lp)
qqline(residuos_lp)
```

## Matemática

### Modelo 0
```{r}
#| warning: false
#| label: modelo0_mt
modelo0_mt <- lmer(PROFICIENCIA_MT_SAEB ~ 1 + (1|ID_ESCOLA), data = df_used)
tab_model(modelo0_mt, show.icc = TRUE)
```	

### Modelo 1
```{r}
#| warning: false
#| label: modelo1_mt
modelo1_mt <- lmer(PROFICIENCIA_MT_SAEB ~  GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + (1|ID_ESCOLA), data = df_used)
tab_model(modelo1_mt, show.icc = TRUE)
```

### Modelo 2
```{r}
#| warning: false
#| label: modelo2_mt
modelo2_mt <- lmer(PROFICIENCIA_MT_SAEB ~  GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA + ID_AREA +  ID_LOCALIZACAO + (1|ID_ESCOLA), data = df_used)
tab_model(modelo2_mt, show.icc = TRUE)
```	

### Modelos 3 (testando efeitos aleatórios)
```{r}
#| warning: false
#| label: modelo3_mt1
modelo3_mt <- lmer(PROFICIENCIA_MT_SAEB ~  GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA + ID_AREA +  ID_LOCALIZACAO + (1 + REPROVACAO|ID_ESCOLA), data = df_used)
tab_model(modelo3_mt, show.icc = TRUE)
```	

```{r}
#| warning: false
#| label: modelo3_mt2
modelo3_mt <- lmer(PROFICIENCIA_MT_SAEB ~  GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA + ID_AREA +  ID_LOCALIZACAO + (1 + GRUPO_RACIAL|ID_ESCOLA), data = df_used)
tab_model(modelo3_mt, show.icc = TRUE)
```	

```{r}
#| warning: false
#| label: modelo3_mt3
modelo3_mt <- lmer(PROFICIENCIA_MT_SAEB ~  GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA + ID_AREA +  ID_LOCALIZACAO + (1 + NSE_ALUNO|ID_ESCOLA), data = df_used)
tab_model(modelo3_mt, show.icc = TRUE)
```	

```{r}
#| warning: false
#| label: modelo3_mt4
modelo3_mt <- lmer(PROFICIENCIA_MT_SAEB ~  GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA + ID_AREA +  ID_LOCALIZACAO + (1 + ESCOLARIDADE_MAE|ID_ESCOLA), data = df_used)
tab_model(modelo3_mt, show.icc = TRUE)
```	

### Modelo 4 (todos os efeitos alerórios do primeiro nível)

```{r}
#| warning: false
#| label: modelo4_mt
modelo4_mt <- lmer(PROFICIENCIA_MT_SAEB ~  GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA + ID_AREA +  ID_LOCALIZACAO + (1 + NSE_ALUNO + REPROVACAO + ESCOLARIDADE_MAE + GRUPO_RACIAL|ID_ESCOLA), data = df_center)
tab_model(modelo4_mt, show.icc = TRUE)
```	

### Modelo 5 (todas interações)

```{r}
#| warning: false
#| label: modelo5_mt
modelo5_mt <- lmer(PROFICIENCIA_MT_SAEB ~  GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA + ID_AREA +  ID_LOCALIZACAO + NSE_ESCOLA:REPROVACAO + NSE_ESCOLA:GRUPO_RACIAL + NSE_ESCOLA:ESCOLARIDADE_MAE + (1 + NSE_ALUNO + REPROVACAO + ESCOLARIDADE_MAE + GRUPO_RACIAL|ID_ESCOLA), data = df_used)
tab_model(modelo5_mt, show.icc = TRUE)
```	

### Modelo 6 (interações relevantes)

```{r}
#| warning: false
#| label: modelo6_mt
modelo6_mt <- lmer(PROFICIENCIA_MT_SAEB ~  GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA + ID_AREA +  ID_LOCALIZACAO + NSE_ESCOLA:REPROVACAO + NSE_ESCOLA:ESCOLARIDADE_MAE +  (1 + NSE_ALUNO + REPROVACAO + ESCOLARIDADE_MAE + GRUPO_RACIAL|ID_ESCOLA), data = df_used)
tab_model(modelo6_mt, show.icc = TRUE)
```	

### Modelo 7 (interações relevantes - efeito aleatório)

```{r}
#| warning: false
#| label: modelo6_mt
modelo7_mt <- lmer(PROFICIENCIA_MT_SAEB ~  GRUPO_RACIAL + ESCOLARIDADE_MAE + REPROVACAO + NSE_ALUNO + NSE_ESCOLA + ID_AREA +  ID_LOCALIZACAO + NSE_ESCOLA:REPROVACAO + NSE_ESCOLA:ESCOLARIDADE_MAE +  (1 + NSE_ALUNO + REPROVACAO + GRUPO_RACIAL|ID_ESCOLA), data = df_used)
tab_model(modelo7_mt, show.icc = TRUE, show.re.var = FALSE)
```	